# 差分

课程链接：[差分](https://www.acwing.com/activity/content/problem/content/831/)

## 基础介绍

构造 $b$ 数组使得 $a_i = b_1 + b_2 + \cdots + a_i$，$a$ 数组为 $b$ 数组的前缀和数组，$b$ 数组是 $a$ 数组的差分数组。  

前缀和数组：$a_1,a_2,a_3,\cdots,a_n$  
差分数组：$b_1,b_2,b_3,\cdots,b_n$

$a$ 数组与 $b$ 数组之间的联系：  

$$
a_0 = 0\\
b_1 = a_1 - a_0\\
b_2 = a_2 - a_1\\
b_3 = a_3 - a_2\\
\vdots \\
b_n = a_n - a_{n - 1}
$$

由差分数组 $b$ 求前缀和即可得到 $a$ 数组。差分数组可以处理以下问题非常方便：

对 $a$ 数组的区间 $[l,r]$ 中的每一个数加上常数 $c$，差分数组可以通过 $O(1)$ 实现，只需执行以下操作：

$$
b_l = b_l + c\\
b_{r + 1} = b_{r + 1} - c
$$

其中 $b_l = b_l + c$ 会使得求前缀和数组 $a$ 中从 $a_l$ 之后的所有元素(包括 $a_l$)都加上常数 $c$ ，而 $b_{r + 1} = b_{r + 1} - c$ 会使得 $a_{r + 1}$ 之后的所有元素(包括 $a_{r+1}$)都减去常数 $c$，由此实现将 $a$ 数组区间上的每一个元素加上常数 $c$。

## 如何求差分数组

假设初始 $a$ 数组中的元素都为 $0$，那么 $b$ 数组中的元素应该也全为0。  
当 $a$ 数组中第 $i$ 个元素变为 $a_i$，那么只需对 $b$ 数组的区间 $[i,i]$ 中的元素都加上常数 $a_i$，即执行下列操作：

$$
b_i = b_i + a_i\\
b_{i + 1} = b_{i + 1} - a_i
$$

每当读取到 $a$ 数组中的一个元素并更新 $b$ 数组，直到 $a$ 数组初始完毕，此时也求得差分数组 $b$。

```c++
for(int i = 1;i <= n;i++){
    scanf("%d",&a[i]);
    b[i] += a[i];
    b[i + 1] -= a[i];
}
```


或者根据 $b$ 数组的定义 $b_i = a_i - a_{i - 1}$ ：

```c++
for(int i = 1;i <= n;i++) b[i] = a[i] - a[i - 1];
```

## 差分数组的作用

当需要多次对 $a$ 数组的某区间 $[l,r]$ 中的所有元素都加上一个常数 $c$ ，并求输出最后的 $a$ 数组，通过差分数组可以在 $O(n)$ 时间内实现。每一次对 $a$ 数组的区间 $[l,r]$ 中的每一个数加上常数 $c$，用差分数组 $b$ 可以通过 $O(1)$ 实现，最后再求 $b$ 数组的前缀和即求得 $a$ 数组。

* 用差分数组 $O(1)$ 实现对 $a$ 数组区间 $[l,r]$ 中的所有元素都加上一个常数 $c$

```c++
b[l] += c;
b[r + 1] -= c;
```

* 由差分数组求前缀和得到最后的 $a$ 数组

```c++
for(int i = 1;i <= n;i++)
    b[i] += b[i - 1];
```